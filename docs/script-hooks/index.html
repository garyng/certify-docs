<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Certify The Web Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Certify The Web Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Certify The Web Docs" href="/opensearch.xml"><title data-react-helmet="true">Scripting | Certify The Web Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Scripting | Certify The Web Docs"><meta data-react-helmet="true" name="description" content="About Scripting"><meta data-react-helmet="true" property="og:description" content="About Scripting"><meta data-react-helmet="true" property="og:url" content="https://docs.certifytheweb.com/docs/script-hooks"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://docs.certifytheweb.com/docs/script-hooks"><link rel="stylesheet" href="/styles.86fa05a5.css">
<link rel="preload" href="/styles.6cc1c419.js" as="script">
<link rel="preload" href="/runtime~main.6989eef9.js" as="script">
<link rel="preload" href="/main.210a0e09.js" as="script">
<link rel="preload" href="/1.1b57dcd4.js" as="script">
<link rel="preload" href="/2.68a6e620.js" as="script">
<link rel="preload" href="/43.06c489e5.js" as="script">
<link rel="preload" href="/46.7dd5fea7.js" as="script">
<link rel="preload" href="/935f2afb.8cee313b.js" as="script">
<link rel="preload" href="/17896441.4b2d9754.js" as="script">
<link rel="preload" href="/76a007c1.451d9816.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Certify The Web - Docs</strong></a><a class="navbar__item navbar__link" href="/docs/intro">Getting Started</a><a class="navbar__item navbar__link" href="/docs/certificate-process">Requesting a Certificate</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/support">Support</a></div><div class="navbar__items navbar__items--right"><a href="https://community.certifytheweb.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Certify The Web - Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/support">Support</a></li><li class="menu__list-item"><a href="https://community.certifytheweb.com" target="_blank" rel="noopener noreferrer" class="menu__link">Community</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/letsencrypt">What is Let&#x27;s Encrypt?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/renewals">Certificate Renewals</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dns/validation">About DNS Validation (dns-01)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/http-validation">About HTTP Validation (http-01)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/tasks_intro">Deployment Tasks</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/script-hooks">Scripting</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Useful Info</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ssl-windows">Using Certificates in Windows</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/commandline">Command Line (CLI) Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csv-import">CSV Bulk Import via Command Line</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backgroundservice">Background Service</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_yu3-">Support</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/support">Support Options</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Scripting</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="about-scripting"></a>About Scripting<a class="hash-link" href="#about-scripting" title="Direct link to heading">#</a></h1><p>Certify is extensible via PowerShell scripts tasks which can be configured to run before or after the Certificate Request. From v5 onwards these are found under the Tasks tab for your managed certificate. See <a href="/docs/deployment/tasks_intro">Tasks</a> for more information.</p><p>The scripts are provided a parameter <code>$result</code> which contains the status and details of the managed certificate being requested. You can execute any commands including creating new processes, or using other command line tools. </p><p>A common use for scripting is to use your new certificate for services other than IIS websites, such as Microsoft Exchange, RDP Gateway, FTP servers and other services. The app also has a range of built-in deployment tasks which also use scripting internally.</p><p><em>By default the background service runs as Local System, so your scripts will execute in that context</em>, this can be important for issues regarding permissions, file system encryption etc. You can optionally configure your task to run as a specific user if network access or special permissions are required.</p><p><strong>Do not store scripts under the C:\Program Files\CertifyTheWeb* folder. File stored there will be deleted next time you update the app</strong></p><p>All scripts should be refined and tested in a staging environment before use in production.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="scripting-basics"></a>Scripting Basics<a class="hash-link" href="#scripting-basics" title="Direct link to heading">#</a></h2><p>Here is a sample PowerShell script which demonstrates a few commonly accessed pieces of information:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)   # required to access the $result parameter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># either $true or $false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.IsSuccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># object containing all information Certify has about the saved Site</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the IIS (or other service) site ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.ServerSiteId   # ex: 1, 2, 3, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the website root directory (if applicable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.RequestConfig.WebsiteRootPath   # ex: &quot;C:\inetpub\wwwroot&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the path to the created/renewed certificate PFX file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificatePath   # ex: &quot;C:\ProgramData\Certify\certes\assets\pfx\00f9e07e-83ca-4029-a173-4b704ee78996.pfx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the certificate thumbprint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificateThumbprintHash # ex: &quot;78b1080a1bf5e7fc0bbb0c0614fc4a18932db5f9&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the previous certificate thumbprint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificatePreviousThumbprintHash  # ex: &quot;18c1060a1be5e6fc0bbb0c0614fc4a18932db5fa&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># You can set $result.Abort to $true in a pre-request hook to prevent the certificate from</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># being requested (has no effect in post-request hooks)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.Abort = $false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>$result.ManagedItem</code> object is an instance of the <a href="https://github.com/webprofusion/certify/blob/development/src/Certify.Models/Config/ManagedCertificate.cs" target="_blank" rel="noopener noreferrer">ManagedCertificate</a> class, so all of the properties it has will be available in your script:</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pre-request-tasks"></a>Pre-Request Tasks<a class="hash-link" href="#pre-request-tasks" title="Direct link to heading">#</a></h2><p>Notes: Pre-request scripts/tasks are executed immediately before the Certificate Request is about to be made (including the challenge file configuration checks).</p><ul><li>The <code>$result.IsSuccess</code> value will always be <code>$false</code>.</li><li>If for some reason your script would like to prevent the Certificate Request from being executed, you may set <code>$result.Abort</code> to <code>$true</code> and the site your script was executed for will be skipped.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deployment-tasks-post-request"></a>Deployment Tasks (Post-Request)<a class="hash-link" href="#deployment-tasks-post-request" title="Direct link to heading">#</a></h2><p>Deployment task (post-request) scripts are executed immediately after the Certificate Request was completed, and the certificate was automatically installed and configured according to the site configuration within Certify.</p><p>By default these run if the request was successful but you can change the task trigger (On Success, On Fail, etc). You can also configure them for manual execution only, so that you can perform them during a maintenance window, or via a windows scheduled task using the command line.</p><ul><li>The <code>$result.IsSuccess</code> value indicates whether or not the Certificate Request was successfully completed.</li><li>The <code>$result.Message</code> value provides a message describing the reason for failure, or a message indicating success.</li></ul><p>Legacy uses for scripting (v4.x and lower) may have previously included CCS Export, PEM file creation etc however these functions are provided by built-in Deployment Tasks which you should use instead unless the built-in functionality does not meet your requirements.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-output-the-result-properties-to-a-text-file"></a>Example: Output the result properties to a text file<a class="hash-link" href="#example-output-the-result-properties-to-a-text-file" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Logs results to the given path (modify as required)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$logpath = &quot;c:\temp\ps-test.txt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$date = Get-Date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath (&quot;-------------------------------------------------&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath (&quot;Script Run Date: &quot; + $date)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath ($result | ConvertTo-Json)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-send-email-via-gmail-after-unsuccessful-renewal"></a>Example: Send email via Gmail after unsuccessful renewal<a class="hash-link" href="#example-send-email-via-gmail-after-unsuccessful-renewal" title="Direct link to heading">#</a></h3><p><em>Note: this is an example only, by default the app will use the certifytheweb.com API to notify you of repeated failures.</em></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (!$result.IsSuccess) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $EmailFrom = &quot;username@gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $EmailTo = &quot;username@gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $Subject = &quot;Cert Request Failed: &quot; + $result.ManagedItem.RequestConfig.PrimaryDomain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $Body = &quot;Error: &quot; + $result.Message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPServer = &quot;smtp.gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient = New-Object Net.Mail.SmtpClient($SmtpServer, 587)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.EnableSsl = $true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.Credentials = New-Object System.Net.NetworkCredential(&quot;username@gmail.com&quot;, &quot;password&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.Send($EmailFrom, $EmailTo, $Subject, $Body)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Sent notification email&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-restart-rras-after-successful-certificate-renewal"></a>Example: Restart RRAS after successful certificate renewal<a class="hash-link" href="#example-restart-rras-after-successful-certificate-renewal" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ($result.IsSuccess -and $result.ManagedItem.GroupId -eq 1) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Restarting RRAS...&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Net Stop RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Net Start RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Done&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-convert-cng-certificate-storage-to-csp-for-exchange-2013"></a>Example: Convert CNG certificate storage to CSP (for Exchange 2013)<a class="hash-link" href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$tempfile = &quot;$env:TEMP\CertifyTemp.pfx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$pfx = get-pfxcertificate -filepath $result.ManagedItem.CertificatePath</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -f -p Certify -exportpfx $pfx.SerialNumber $tempfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -delstore my $pfx.SerialNumber</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -p Certify -csp &quot;Microsoft RSA SChannel Cryptographic Provider&quot; -importpfx $tempfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">remove-item $tempfile</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-enable-certificate-for-exchange-2013--2016-services-on-local-server"></a>Example: Enable certificate for Exchange 2013 / 2016 services on local server<a class="hash-link" href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enable-ExchangeCertificate -Thumbprint $result.ManagedItem.CertificateThumbprintHash -Services POP,IMAP,SMTP,IIS -Force</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-update-vmware-horizon-certificate"></a>Example: Update VMWare Horizon certificate<a class="hash-link" href="#example-update-vmware-horizon-certificate" title="Direct link to heading">#</a></h3><p>This example removes any previous certificate with the same FriendlyName (<code>vdm</code>) then renames the Friendly Name property of the new certificate to <code>vmd</code>. It then restarts the <code>wstunnel</code> service.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ($result.IsSuccess) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $thumbprint = $result.ManagedItem.CertificateThumbprintHash # e.g. 2c127d49b4f63d947dd7b91750c9e57751eced0c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   # remove the old cert (by Friendly Name &#x27;vdm&#x27;) to avoid duplication, if it exists</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Get-ChildItem -Path cert:\LocalMachine\My | Where {$_.FriendlyName.Equals(&quot;vdm&quot;)} | Remove-Item</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   # rename our new certificate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $cert = Get-ChildItem -Path cert:\LocalMachine\My\$thumbprint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $cert.FriendlyName =&quot;vdm&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   # restart the wstunnel service to apply certificate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Restart-Service wstunnel -Force -ErrorAction Stop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-update-certificate-for-sstp-vpn"></a>Example: Update certificate for SSTP VPN<a class="hash-link" href="#example-update-certificate-for-sstp-vpn" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-PowerShell codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Store certificate in variable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$cert = Get-ChildItem -Path Cert:\LocalMachine\My | Where-Object {$_.Thumbprint -match $result.ManagedItem.CertificateThumbprintHash}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Stop RRAS, set cert, start RRAS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Import-Module RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Stop-Service RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Set-RemoteAccess -SslCertificate $cert</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Start-Service RemoteAccess</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-update-sql-server-reporting-services"></a>Example: Update SQL Server Reporting Services<a class="hash-link" href="#example-update-sql-server-reporting-services" title="Direct link to heading">#</a></h3><p>This is adapted from a community example: <a href="https://community.certifytheweb.com/t/sql-server-reporting-services-ssrs/332/7" target="_blank" rel="noopener noreferrer">https://community.certifytheweb.com/t/sql-server-reporting-services-ssrs/332/7</a>  </p><p>This script gets the report server config object the checks if an existing cert is bound it removes that, then creates the new binding.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ssrsServerName = &quot;RS_MSSQLSERVER&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ssrsReportManagerName = &quot;ReportManager&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ssrsReportWebServiceName = &quot;ReportServerWebService&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$httpsPort = 443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ipAddress = &quot;0.0.0.0&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Find the ssrsServerName by running:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Get-WmiObject -namespace root\Microsoft\SqlServer\ReportServer -class __Namespace</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># take the value of the name field</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$version = (Get-WmiObject â€“namespace root\Microsoft\SqlServer\ReportServer\$ssrsServerName  â€“class __Namespace).Name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$rsConfig = Get-WmiObject â€“namespace &quot;root\Microsoft\SqlServer\ReportServer\$ssrsServerName\$version\Admin&quot; -class MSReportServer_ConfigurationSetting</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the cert thumbnail of the newest certificate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$newthumb = $result.ManagedItem.CertificateThumbprintHash.ToLower()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># check the cert thumbnail of the currently bound certificate (if any)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$oldthumb = &#x27;&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $oldthumb = $rsConfig.ListSSLCertificateBindings(1033).CertificateHash.Item([array]::LastIndexOf($rsConfig.ListSSLCertificateBindings(1033).Application, $ssrsReportManagerName))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   if ($oldthumb -ne $newthumb) {      </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $rsConfig.RemoveSSLCertificateBindings($ssrsReportManagerName, $oldthumb, $ipAddress, $httpsport, 1033) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      $rsConfig.RemoveSSLCertificateBindings($ssrsReportWebServiceName, $oldthumb, $ipAddress, $httpsport, 1033)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} catch {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$rsConfig.CreateSSLCertificateBinding($ssrsReportManagerName, $newthumb, $ipAddress, $httpsport, 1033)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$rsConfig.CreateSSLCertificateBinding($ssrsReportWebServiceName, $newthumb, $ipAddress, $httpsport, 1033) </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="troubleshooting"></a>Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">#</a></h2><ul><li><p>In the Certify UI, you may test scripts by clicking the â–¶ button. You should ideally test scripts after you have completed a successful certificate request so that you have real results and a certificate to work with.</p></li><li><p>The <code>$result.ManagedItem.CertificatePath</code> value will be set to the filename (including path) of the PFX file containing the requested certificate, unless the site is new and has not had a successful Certificate Request, in which case the value will not be set.</p></li><li><p>PowerShell Execution Policies may be set by your administrator which affect script execution. The app will try to set the policy to &quot;Unrestricted&quot; by default which may conflict with higher level policy settings. You can set the default script execution policy in the server settings file (then restart the Certify background service) <code>%PROGRAMDATA%\Certify\serviceconfig.json</code></p><ul><li><code>&quot;PowershellExecutionPolicy&quot;:&quot;Unrestricted&quot;</code> or</li><li><code>&quot;PowershellExecutionPolicy&quot;:&quot;Bypass&quot;</code> or</li><li><code>&quot;PowershellExecutionPolicy&quot;:&quot;&quot;</code> (blank string) to use the default policy set by your administrator.</li></ul></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/webprofusion/certify-docs/edit/master/docs/script-hooks.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/deployment/tasks_intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Deployment Tasks</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/ssl-windows"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using Certificates in Windows Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#scripting-basics" class="table-of-contents__link">Scripting Basics</a></li><li><a href="#pre-request-tasks" class="table-of-contents__link">Pre-Request Tasks</a></li><li><a href="#deployment-tasks-post-request" class="table-of-contents__link">Deployment Tasks (Post-Request)</a><ul><li><a href="#example-output-the-result-properties-to-a-text-file" class="table-of-contents__link">Example: Output the result properties to a text file</a></li><li><a href="#example-send-email-via-gmail-after-unsuccessful-renewal" class="table-of-contents__link">Example: Send email via Gmail after unsuccessful renewal</a></li><li><a href="#example-restart-rras-after-successful-certificate-renewal" class="table-of-contents__link">Example: Restart RRAS after successful certificate renewal</a></li><li><a href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" class="table-of-contents__link">Example: Convert CNG certificate storage to CSP (for Exchange 2013)</a></li><li><a href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" class="table-of-contents__link">Example: Enable certificate for Exchange 2013 / 2016 services on local server</a></li><li><a href="#example-update-vmware-horizon-certificate" class="table-of-contents__link">Example: Update VMWare Horizon certificate</a></li><li><a href="#example-update-sql-server-reporting-services" class="table-of-contents__link">Example: Update SQL Server Reporting Services</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link">Troubleshooting</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/support">Support</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://community.certifytheweb.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li><li class="footer__item"><a href="https://github.com/webprofusion/certify" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/webprofusion/certify" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/certifytheweb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Webprofusion Pty Ltd. Docs Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.6cc1c419.js"></script>
<script src="/runtime~main.6989eef9.js"></script>
<script src="/main.210a0e09.js"></script>
<script src="/1.1b57dcd4.js"></script>
<script src="/2.68a6e620.js"></script>
<script src="/43.06c489e5.js"></script>
<script src="/46.7dd5fea7.js"></script>
<script src="/935f2afb.8cee313b.js"></script>
<script src="/17896441.4b2d9754.js"></script>
<script src="/76a007c1.451d9816.js"></script>
</body>
</html>